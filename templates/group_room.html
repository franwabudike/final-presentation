<!-- templates/group_room.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>VibeRoom - Group Room</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.socket.io/4.3.2/socket.io.min.js"></script>
</head>
<body>
    {% include 'navbar.html' %}
    <main class="main-content">
        <h1>üéß Group Room: {{ room_id }}</h1>
        <div id="chat-log" style="background:#f5f5f5;padding:1rem;border-radius:8px;margin-bottom:1rem;"></div>

        <form id="track-form">
            <input type="text" id="track-url" placeholder="Paste YouTube link..." required>
            <button type="submit">Play</button>
        </form>

        <div style="margin-top:1rem;">
            <button onclick="skipTrack()">‚è≠ Skip Track</button>
        </div>

        <div id="player-container" style="margin-top:2rem;">
            <!-- Embedded YouTube player will go here -->
        </div>
    </main>
    {% include 'footer.html' %}

    <script>
        const socket = io();
        const room = "{{ room_id }}";
        const username = "{{ user or 'Guest' }}";

        socket.emit('join', { room: room, username: username });

        socket.on('status', data => {
            const log = document.getElementById('chat-log');
            log.innerHTML += `<p><strong>${data.msg}</strong></p>`;
        });

        socket.on('play_track', data => {
            const player = document.getElementById('player-container');
            const videoId = extractVideoId(data.track);
            if (videoId) {
                player.innerHTML = `<iframe width="560" height="315" src="https://www.youtube.com/embed/${videoId}?autoplay=1" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
            }
        });

        socket.on('skip_track', () => {
            const player = document.getElementById('player-container');
            player.innerHTML = '<p>Track skipped ‚è≠</p>';
        });

        document.getElementById('track-form').addEventListener('submit', function (e) {
            e.preventDefault();
            const url = document.getElementById('track-url').value;
            socket.emit('play_track', { room: room, track: url });
            document.getElementById('track-url').value = '';
        });

        function skipTrack() {
            socket.emit('skip_track', { room: room });
        }

        function extractVideoId(url) {
            const match = url.match(/(?:youtu\.be\/|youtube\.com\/(?:watch\?v=|embed\/))([^\s&]+)/);
            return match ? match[1] : null;
        }
    </script>
</body>
</html>
